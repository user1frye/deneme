<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Emre'nin Oyunu - Snake</title>
  <style>
    body{margin:0;display:grid;place-items:center;min-height:100vh;font-family:system-ui;background:#0b1220;color:#e6edf3}
    .card{width:min(720px,92vw);background:#111a2e;border:1px solid #223055;border-radius:16px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h1{margin:0 0 8px;font-size:22px}
    p{margin:6px 0 14px;opacity:.9}
    canvas{background:#050a14;border:1px solid #223055;border-radius:12px;display:block;width:100%;height:auto}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-top:12px}
    .btn{cursor:pointer;border:1px solid #2b3c6a;background:#162344;color:#e6edf3;border-radius:12px;padding:10px 14px;font-weight:600}
    .btn:active{transform:translateY(1px)}
    .pill{padding:8px 12px;border:1px solid #2b3c6a;border-radius:999px;background:#0e1730}
    kbd{border:1px solid #2b3c6a;border-bottom-width:3px;padding:2px 6px;border-radius:6px;background:#0e1730}
  </style>
</head>
<body>
  <div class="card">
    <h1>Snake (Yılan)</h1>
    <p><kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd> veya ok tuşlarıyla oyna. Duvara veya kendine çarparsan biter.</p>
    <canvas id="game" width="600" height="420"></canvas>
    <div class="row">
      <button class="btn" id="restart">Yeniden Başlat</button>
      <div class="pill">Skor: <span id="score">0</span> | En İyi: <span id="best">0</span></div>
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");
  const scoreEl = document.getElementById("score");
  const bestEl = document.getElementById("best");
  const restartBtn = document.getElementById("restart");

  const CELL = 20;
  const COLS = Math.floor(canvas.width / CELL);
  const ROWS = Math.floor(canvas.height / CELL);

  let snake, dir, nextDir, food, score, best, alive, tickMs, lastTime;

  best = Number(localStorage.getItem("snake_best") || 0);
  bestEl.textContent = best;

  function randCell() {
    return { x: Math.floor(Math.random() * COLS), y: Math.floor(Math.random() * ROWS) };
  }

  function placeFood() {
    let f;
    do {
      f = randCell();
    } while (snake.some(s => s.x === f.x && s.y === f.y));
    food = f;
  }

  function reset() {
    snake = [{x: Math.floor(COLS/2), y: Math.floor(ROWS/2)}];
    dir = {x: 1, y: 0};
    nextDir = {...dir};
    score = 0;
    alive = true;
    tickMs = 110; // hız
    lastTime = 0;
    scoreEl.textContent = score;
    placeFood();
    draw();
  }

  function setDir(x,y){
    // tersine dönmeyi engelle
    if (snake.length > 1 && (x === -dir.x && y === -dir.y)) return;
    nextDir = {x,y};
  }

  window.addEventListener("keydown", (e) => {
    const k = e.key.toLowerCase();
    if (k === "arrowup" || k === "w") setDir(0,-1);
    else if (k === "arrowdown" || k === "s") setDir(0,1);
    else if (k === "arrowleft" || k === "a") setDir(-1,0);
    else if (k === "arrowright" || k === "d") setDir(1,0);
    else if (k === " " && !alive) reset();
  });

  restartBtn.addEventListener("click", reset);

  function step() {
    if (!alive) return;

    dir = nextDir;

    const head = snake[0];
    const nh = { x: head.x + dir.x, y: head.y + dir.y };

    // duvar
    if (nh.x < 0 || nh.x >= COLS || nh.y < 0 || nh.y >= ROWS) {
      alive = false;
      finish();
      return;
    }

    // kendine çarpma
    if (snake.some((s,i) => i!==0 && s.x === nh.x && s.y === nh.y)) {
      alive = false;
      finish();
      return;
    }

    snake.unshift(nh);

    // yemek
    if (nh.x === food.x && nh.y === food.y) {
      score += 10;
      scoreEl.textContent = score;
      if (score > best) {
        best = score;
        localStorage.setItem("snake_best", best);
        bestEl.textContent = best;
      }
      // biraz hızlan
      tickMs = Math.max(70, tickMs - 2);
      placeFood();
    } else {
      snake.pop();
    }

    draw();
  }

  function finish() {
    draw(true);
  }

  function draw(gameOver=false) {
    // zemin
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // grid hafif
    ctx.globalAlpha = 0.08;
    for (let x=0;x<=COLS;x++){
      ctx.beginPath(); ctx.moveTo(x*CELL,0); ctx.lineTo(x*CELL,canvas.height); ctx.strokeStyle="#8ab4ff"; ctx.stroke();
    }
    for (let y=0;y<=ROWS;y++){
      ctx.beginPath(); ctx.moveTo(0,y*CELL); ctx.lineTo(canvas.width,y*CELL); ctx.strokeStyle="#8ab4ff"; ctx.stroke();
    }
    ctx.globalAlpha = 1;

    // food
    ctx.fillStyle = "#ffb86b";
    ctx.fillRect(food.x*CELL, food.y*CELL, CELL, CELL);

    // snake
    for (let i=0;i<snake.length;i++){
      const s = snake[i];
      ctx.fillStyle = i===0 ? "#8fffbc" : "#4eea92";
      ctx.fillRect(s.x*CELL, s.y*CELL, CELL, CELL);
    }

    if (gameOver) {
      ctx.fillStyle = "rgba(0,0,0,0.55)";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = "#e6edf3";
      ctx.font = "bold 34px system-ui";
      ctx.textAlign = "center";
      ctx.fillText("GAME OVER", canvas.width/2, canvas.height/2 - 10);
      ctx.font = "16px system-ui";
      ctx.fillText("Boşluk (Space) veya 'Yeniden Başlat' ile tekrar oyna", canvas.width/2, canvas.height/2 + 22);
    }
  }

  function loop(ts){
    if (!lastTime) lastTime = ts;
    const delta = ts - lastTime;
    if (delta >= tickMs) {
      lastTime = ts;
      step();
    }
    requestAnimationFrame(loop);
  }

  reset();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
